<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>luq_streamchem - Stream chemistry, Luquillo Mountains of Puerto Rico (LUQ) • lterdatasampler</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="luq_streamchem - Stream chemistry, Luquillo Mountains of Puerto Rico (LUQ)">
<meta property="og:description" content="lterdatasampler">
<meta property="og:image" content="https://lter.github.io/lterdatasampler/reference/figures/leaf.png">
<meta property="og:image:alt" content="lterdatasampler package in R">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@allison_horst">
<meta name="twitter:site" content="@allison_horst">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">lterdatasampler</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/and_vertebrates_vignette.html">and_vertebrates - Andrews Forest LTER Mack Creek cutthroat trout and salamanders (AND)</a>
    </li>
    <li>
      <a href="../articles/arc_weather_vignette.html">arc_weather - Arctic LTER Toolik Field Station (ARC)</a>
    </li>
    <li>
      <a href="../articles/hbr_maples_vignette.html">hbr_maples - Hubbard Brook Experimental Forest Sugar Maples (HBR)</a>
    </li>
    <li>
      <a href="../articles/knz_bison_vignette.html">knz_bison - Konza Prairie Bison Weights (KNZ)</a>
    </li>
    <li>
      <a href="../articles/luq_streamchem_vignette.html">luq_streamchem - Stream chemistry, Luquillo Mountains of Puerto Rico (LUQ)</a>
    </li>
    <li>
      <a href="../articles/ntl_icecover_vignette.html">ntl_icecover - North Temperate Lakes Ice Cover (NTL)</a>
    </li>
    <li>
      <a href="../articles/nwt_pikas_vignette.html">nwt_pikas - Niwot Ridge Pika Locations (NWT)</a>
    </li>
    <li>
      <a href="../articles/pie_crab_vignette.html">pie_crab - Plum Island Ecosystem LTER fiddler crabs (PIE)</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lter/lterdatasampler/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>luq_streamchem - Stream chemistry, Luquillo
Mountains of Puerto Rico (LUQ)</h1>
            <h3 data-toc-skip class="subtitle">Impact of hurricane Hugo
on stream chemistry for Quebrada Sonadora site</h3>
            
      
      <small class="dont-index">Source: <a href="https://github.com/lter/lterdatasampler/blob/HEAD/vignettes/articles/luq_streamchem_vignette.Rmd" class="external-link"><code>vignettes/articles/luq_streamchem_vignette.Rmd</code></a></small>
      <div class="hidden name"><code>luq_streamchem_vignette.Rmd</code></div>

    </div>

    
    
<div class="section level4">
<h4 id="dataset-sample-used">Dataset sample used<a class="anchor" aria-label="anchor" href="#dataset-sample-used"></a>
</h4>
<ul>
<li><code>luq_streamchem</code></li>
</ul>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette highlights:</p>
<ul>
<li>How to explore change points in time-series</li>
<li>How to use long format to create facet plots</li>
</ul>
<p>The <code>luq_streamchem</code> data sample contains a subset of
stream flow chemistry data for the Quebrada Sonadora (QS) site within
the Espiritu Santo drainage basin and the El Verde Research area of the
Luquillo Experimental Forest (LEF). The Luquillo Experimental Forest
(LEF) has been a center of tropical forestry research for nearly a
century. In addition, the LEF is a recreation site for over a half a
million people per year, a water supply for approximately 20% of Puerto
Rico’s population, a regional center for electronic communication, and a
refuge of Caribbean biodiversity. QS is the high elevation site.</p>
<figure style="text-align:center;"><img src="../reference/figures/luq_streamchem_img.jpeg" width="60%" style="display:block; margin-left: auto; margin-right: auto;"><figcaption>
Credit: Luquillo LTER. CC BY-SA 4.0
</figcaption></figure><p><br></p>
</div>
<div class="section level2">
<h2 id="exploring-the-time-series">Exploring the time-series<a class="anchor" aria-label="anchor" href="#exploring-the-time-series"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lter/lterdatasampler" class="external-link">lterdatasampler</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">Attaching core tidyverse packages</span> ──────────────────────── tidyverse 2.0.0 ──</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dplyr    </span> 1.1.2     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">readr    </span> 2.1.4</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">forcats  </span> 1.0.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">stringr  </span> 1.5.0</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">ggplot2  </span> 3.4.2     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tibble   </span> 3.2.1</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">lubridate</span> 1.9.2     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tidyr    </span> 1.3.0</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">purrr    </span> 1.0.2     </span></span>
<span><span class="co">## ── <span style="font-weight: bold;">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span> masks <span style="color: #0000BB;">stats</span>::filter()</span></span>
<span><span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>    masks <span style="color: #0000BB;">stats</span>::lag()</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use the conflicted package (<span style="color: #0000BB; font-style: italic;">&lt;http://conflicted.r-lib.org/&gt;</span>) to force all conflicts to become errors</span></span></code></pre>
<div class="section level3">
<h3 id="ice-cover-duration-data">Ice Cover Duration Data<a class="anchor" aria-label="anchor" href="#ice-cover-duration-data"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">luq_streamchem</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 317</span></span>
<span><span class="co">## Columns: 22</span></span>
<span><span class="co">## $ sample_id   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "QS", "QS", "QS", "QS", "QS", "QS", "QS", "QS", "QS", "QS"…</span></span>
<span><span class="co">## $ sample_date <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1987-01-05, 1987-01-13, 1987-01-20, 1987-01-27, 1987-02-0…</span></span>
<span><span class="co">## $ gage_ht     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2.82, 2.66, 2.61, 2.58, 2.80, 2.63, 2.84, 2.68, 2.76, 2.64…</span></span>
<span><span class="co">## $ temp        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 20, 20, 20, 20, 20, 20, 20, 19, 20, 20, 19, 21, 20, 21, 21…</span></span>
<span><span class="co">## $ p_h         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 7.22, 7.34, 7.12, 7.19, 7.36, 7.19, NA, 6.93, 7.02, 7.17, …</span></span>
<span><span class="co">## $ cond        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 48.2, 49.8, 50.3, 50.4, 49.6, 53.3, 43.7, 48.4, 48.4, 49.9…</span></span>
<span><span class="co">## $ cl          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 7.30, 7.50, 7.50, 7.30, 7.30, 7.20, 7.00, 7.30, 7.60, 7.30…</span></span>
<span><span class="co">## $ no3_n       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 97, 114, 115, 117, 103, 110, 94, 90, 86, 97, 218, 71, 83, …</span></span>
<span><span class="co">## $ so4_s       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.52, 0.73, NA, NA, 0.85, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">## $ na          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 4.75, 4.81, 5.19, 5.08, 4.86, 5.11, 4.80, 5.08, 4.90, 4.89…</span></span>
<span><span class="co">## $ k           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.18, 0.19, 0.20, 0.18, 0.17, 0.18, 0.17, 0.18, 0.20, 0.20…</span></span>
<span><span class="co">## $ mg          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.50, 1.58, 1.66, 1.64, 1.49, 1.59, 1.44, 1.60, 1.64, 1.51…</span></span>
<span><span class="co">## $ ca          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2.46, 6.53, 2.60, 2.67, 2.39, 2.55, 2.33, 2.48, 2.55, 2.81…</span></span>
<span><span class="co">## $ nh4_n       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 14, 20, 25, 30, 25, 30, 7, 6, NA, NA, NA, NA, NA, NA, 7, 1…</span></span>
<span><span class="co">## $ po4_p       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span></span>
<span><span class="co">## $ doc         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.72, 0.74, 0.69, 0.62, 0.75, 0.61, 1.78, 1.85, 1.49, 1.29…</span></span>
<span><span class="co">## $ dic         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 3.37, 3.35, 4.42, 3.30, 5.03, 4.18, 2.40, 2.90, 2.46, 3.34…</span></span>
<span><span class="co">## $ tdn         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span></span>
<span><span class="co">## $ tdp         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span></span>
<span><span class="co">## $ si_o2       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 11.8, 12.2, 12.5, 12.4, 10.9, 12.2, 11.1, 12.5, 11.8, 12.3…</span></span>
<span><span class="co">## $ don         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span></span>
<span><span class="co">## $ tss         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2.30, 0.72, 1.05, 1.05, 1.60, 1.32, 1.23, 1.18, 1.20, 0.96…</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="plotting-one-chemical">Plotting one chemical<a class="anchor" aria-label="anchor" href="#plotting-one-chemical"></a>
</h3>
<p>Let’s start with looking at the time-series of potassium</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">luq_streamchem</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">sample_date</span>, y<span class="op">=</span><span class="va">k</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color<span class="op">=</span><span class="st">"#69b3a2"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle<span class="op">=</span><span class="fl">60</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Potassium [mg/L]"</span><span class="op">)</span> </span></code></pre></div>
<p><img src="luq_streamchem_vignette_files/figure-html/unnamed-chunk-1-1.png" width="624"></p>
<p>Wow there is definitely something going on at the end of 1989!</p>
</div>
<div class="section level3">
<h3 id="plotting-all-water-quality-indicators">Plotting all water quality indicators<a class="anchor" aria-label="anchor" href="#plotting-all-water-quality-indicators"></a>
</h3>
<p>We are not sure if all the chemicals and water quality indicators
have been monitored over the same time period, or if their value will
also show strong variations at the end of 1989. To explore this we will
transform our data frame into long format so we can use
<code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">ggplot2::facet_wrap()</a></code> to quickly plot all observed stream
chemistry variables at once. Note we are using the
<code>scales = free</code> option since the concentrations (and units)
vary greatly among the different variables.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Switching to long format</span></span>
<span><span class="va">luq_streamchem_long</span> <span class="op">&lt;-</span> <span class="va">luq_streamchem</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sample_id</span>, <span class="va">sample_date</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"chem_param"</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">luq_streamchem_long</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">sample_date</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color<span class="op">=</span><span class="st">"#69b3a2"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">chem_param</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span></code></pre></div>
<p><img src="luq_streamchem_vignette_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>It seems that other chemicals are also showing a jump around the end
of 1989. Actually those jumps are due to Hurricane Hugo which made
landfall in Puerto Rico at the beginning of September 1989. In its
aftermath, average stream water exports of potassium, nitrate and
ammonium increased in the year after the landfall by 119, 182 and 102%
respectively compared to the other years of record.</p>
</div>
</div>
<div class="section level2">
<h2 id="detecting-change-points-in-a-time-series">Detecting change points in a time-series<a class="anchor" aria-label="anchor" href="#detecting-change-points-in-a-time-series"></a>
</h2>
<p>Let’s first confirm that the timing of the jump in the time-series
corresponds to Hurricane Hugo by adding a vertical line at the date of
hurricane landfall.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">luq_streamchem</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">sample_date</span>, y<span class="op">=</span><span class="va">k</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color<span class="op">=</span><span class="st">"#69b3a2"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"1989-09-18"</span><span class="op">)</span>, </span>
<span>             linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle<span class="op">=</span><span class="fl">60</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Potassium [mg/L]"</span><span class="op">)</span> </span></code></pre></div>
<p><img src="luq_streamchem_vignette_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<div class="section level4">
<h4 id="what-could-be-next">What could be next<a class="anchor" aria-label="anchor" href="#what-could-be-next"></a>
</h4>
<p>There are many R packages available to help to detect change points
in a time series: <a href="https://cran.r-project.org/web/packages/changepoint/index.html" class="external-link"><code>changepoint</code></a>,
<a href="https://cran.r-project.org/web/packages/cpm/index.html" class="external-link"><code>CPM</code></a>,
<a href="https://cran.r-project.org/web/packages/bcp/index.html" class="external-link"><code>BCP</code></a>,
<a href="https://cran.r-project.org/web/packages/ecp/index.html" class="external-link"><code>ECP</code></a>
and more! Try to use them on this data sample.</p>
</div>
<div class="section level3">
<h3 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<p>Schaefer, D., McDowell, W., Scatena, F., &amp; Asbury, C. (2000).
Effects of hurricane disturbance on stream water concentrations and
fluxes in eight tropical forest watersheds of the Luquillo Experimental
Forest, Puerto Rico. Journal of Tropical Ecology, 16(2), 189-207. <a href="https://doi.org/10.1017/S0266467400001358" class="external-link">doi:10.1017/S0266467400001358</a></p>
<p>McDowell, W. 2021. Chemistry of stream water from the Luquillo
Mountains ver 4923056. Environmental Data Initiative. <a href="https://doi.org/10.6073/pasta/0a09f5aa2e6f11451553c92b102279a6" class="external-link uri">https://doi.org/10.6073/pasta/0a09f5aa2e6f11451553c92b102279a6</a>
(Accessed 2022-03-10)</p>
<p>Killick, R., &amp; Eckley, I. A. (2014). changepoint: An R Package
for Changepoint Analysis. Journal of Statistical Software, 58(3), 1–19.
<a href="https://doi.org/10.18637/jss.v058.i03" class="external-link uri">https://doi.org/10.18637/jss.v058.i03</a></p>
</div>
</div>
<div class="section level2">
<h2 id="how-we-processed-the-raw-data">How we processed the raw data<a class="anchor" aria-label="anchor" href="#how-we-processed-the-raw-data"></a>
</h2>
<div class="section level4">
<h4 id="download-the-raw-data-from-edi-org">Download the raw data from EDI.org<a class="anchor" aria-label="anchor" href="#download-the-raw-data-from-edi-org"></a>
</h4>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://usethis.r-lib.org" class="external-link">usethis</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nceas/metajam" class="external-link">metajam</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sfirke/janitor" class="external-link">janitor</a></span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Chemistry of stream water from the Luquillo Mountains</span></span>
<span><span class="co"># McDowell, W. 2021. Chemistry of stream water from the Luquillo Mountains ver 4923053.</span></span>
<span><span class="co"># Environmental Data Initiative. https://doi.org/10.6073/pasta/c6c35d45f7b25baac164acf42a40e95e (Accessed 2021-09-24).</span></span>
<span><span class="va">luq_url</span> <span class="op">&lt;-</span> <span class="st">"https://portal.edirepository.org/nis/dataviewer?packageid=knb-lter-luq.20.4923053&amp;entityid=a05bda0a0af888cc037ff5dd00dafd7e"</span></span>
<span><span class="va">stream_chem_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metajam/man/download_d1_data.html" class="external-link">download_d1_data</a></span><span class="op">(</span>data_url <span class="op">=</span> <span class="va">luq_url</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="filter-the-data">Filter the Data<a class="anchor" aria-label="anchor" href="#filter-the-data"></a>
</h4>
<p>We want to analyze the effect of hurricane Hugo which made landfall
in September 1989. We are going to use the period from 1985 to 1994.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read that data</span></span>
<span><span class="co"># View(stream_chem$attribute_metadata)</span></span>
<span><span class="co"># -9999 is stated a no value in the metadata</span></span>
<span><span class="va">stream_chem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metajam/man/read_d1_files.html" class="external-link">read_d1_files</a></span><span class="op">(</span><span class="va">stream_chem_path</span><span class="op">)</span></span>
<span><span class="va">luq_stream_chem_data</span> <span class="op">&lt;-</span> <span class="va">stream_chem</span><span class="op">$</span><span class="va">data</span></span>
<span></span>
<span><span class="co"># Filter from 1987 to 1992</span></span>
<span><span class="va">luq_streamchem</span> <span class="op">&lt;-</span> <span class="va">luq_stream_chem_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">Sample_Date</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1986</span> <span class="op">&amp;</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">Sample_Date</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1993</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Sample_Time</span>, <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"Code"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># remove unwated columns</span></span>
<span>  <span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html" class="external-link">clean_names</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://www.allisonhorst.com/" class="external-link">Allison Horst</a>, <a href="https://brunj7.github.io/" class="external-link">Julien Brun</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
